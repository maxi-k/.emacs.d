#+TITLE: Setup programming
#+DESCRIPTION: Setup prog-mode, which is the major mode all programming major modes extend from, and other stuff that has to do with programming
#+AUTHOR: Maximilian Kuschewski
#+PROPERTY: my-file-type emacs-config-package

* Autocomplete
Don't to autocomplete for now - it slows down writing quite a bit
#+begin_src emacs-lisp
;; (add-hook 'prog-mode-hook 'auto-complete-mode)
#+end_src
* :use-package flycheck
** :defer t
* :use-package rainbow-delimiters
** :init
#+begin_src emacs-lisp
(add-hook 'prog-mode-hook #'rainbow-delimiters-mode)
#+end_src
** :init
*** :use-package rainbow-identifiers
**** :defer t
* :use-package quickrun
Quickrun can 'run' any (most) buffers - useful for developing bigger chunks of
code in a buffer, which quickrun turns into a kinda-repl
** :defer t
** :init
Bind a key to 'quickrun' the current buffer
#+begin_src emacs-lisp
(config/provide-feature :buffer "r" 'quickrun)
#+end_src
** :config
Don't timeout after 10 seconds if the program has not finished executing yet
#+begin_src emacs-lisp
(setq quickrun-timeout-seconds 120)
#+end_src
** :bind
Use cmd-r to run it
#+begin_src emacs-lisp
("s-r" . quickrun)
#+end_src
* :use-package company
Autocompletion / Suggestions with support for various backends
** :defer t
** :init
Add a hook to any programming-language-mode for company
#+begin_src emacs-lisp
(add-hook 'prog-mode-hook #'company-mode)

;; aligns annotation to the right hand side
(setq company-tooltip-align-annotations t)

(setq company-idle-delay 0.2)
#+end_src
** :config
*** :use-package company-quickhelp
Show documentation for given function in a company-style popup
**** :init
#+begin_src emacs-lisp
;; (company-quickhelp-mode 1)
#+end_src
**** :config
#+begin_src emacs-lisp
;; (define-key company-active-map (kbd "M-S-h") #'company-quickhelp-manual-begin)
#+end_src
* :use-package outshine
** :defer t
** :init
#+begin_src emacs-lisp
(setq outshine-use-speed-commands t)
(add-hook 'outline-minor-mode-hook 'outshine-hook-function)
#+end_src
* Languages
** :use-package lsp-mode
The language server protocol can (and should) be used by any language
specific mode to provide auto-completion, highlighting etc.
*** :defer t
*** :init
#+begin_src emacs-lisp
(config/global-keys
  "l" 'lsp-command-map)

#+end_src
**** :use-package lsp-ui
Lsp-UI can be used to display information about the code in the ui
***** :defer t
** :use-package swift-mode
*** :defer t
** :use-package arduino-mode
** :use-package company-arduino
** :use-package kotlin-mode
*** :defer t
*** :mode
#+begin_src emacs-lisp
("\\.kt\\'" . kotlin-mode)
#+end_src
** :use-package rustic
*** :init
Use the default client provided by `lsp-mode', not the one rustic-mode sets up.
#+begin_src emacs-lisp
(setq rustic-lsp-server 'rust-analyzer)
#+end_src

Disable the flycheck error display in the mode-line, it's distracting.
#+begin_src emacs-lisp
(setq rustic-flycheck-setup-mode-line-p nil)
#+end_src

*** :hook
#+begin_src emacs-lisp
((rustic-mode . (lambda ()
                  (when (functionp 'lsp-ui-mode)
                    (lsp-ui-doc-mode)
                    (lsp-ui-sideline-mode)
                    (lsp-ui-sideline-toggle-symbols-info))
                  (company-mode))))
#+end_src
*** :config
Some more configuration settings
#+begin_src emacs-lisp
(setq rust-indent-method-chain t)
(setq rustic-format-on-save t)
(setq rustic-format-display-method #'display-buffer-at-bottom)
#+end_src

Set up mode-local keys
#+begin_src emacs-lisp
(config/local-keys 'rustic-mode
  "," 'rustic-popup
  "d" 'lsp-find-definition
  "r" 'lsp-find-references
  "i" 'lsp-find-implementation
  "h" 'lsp-describe-thing-at-point
  "o" 'lsp-organize-imports)
#+end_src

* Setups for single modes
Require the mode-specific setup files that configure programming-modes:
#+begin_src emacs-lisp
  (require-all
   '(setup-c
     setup-elixir
     setup-go
     setup-lisp
     setup-markdown
     setup-haskell
     setup-statistics
     setup-web
     ))
#+end_src
* Provide it
#+begin_src emacs-lisp
(provide 'setup-programming)
#+end_src
